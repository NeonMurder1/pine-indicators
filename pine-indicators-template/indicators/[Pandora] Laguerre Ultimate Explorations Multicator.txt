// Use and reuse of this code is governed by the terms of the Attribution-NonCommercial-ShareAlike 4.0 International License. https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.txt

//@version=6
indicator('[Pandora] Laguerre Ultimate Explorations Multicator', 'LUEM', overlay=false, precision=2, timeframe='')

laguerreMulti(series float       Series,
              simple float       Period,
              simple float          Lag=0.5,
              simple float LaguerreMode=3,
              simple int      RMSperiod=100) =>
    //≡≡≡≡≡ All-in-One Laguerre Ultimate Filter ≡≡≡≡≡//
    var const float SQRT2 = math.sqrt(2.0)
    // ▼▼▼▼▼ Ultimate Smoother ▼▼▼▼▼
    var    float omega = math.pi * SQRT2 / math.max(1, Period)
    var    float alpha = math.exp(-omega)
    var    float coef1 = math.cos( omega) * 2.0 * alpha
    var    float coef2 = math.pow(alpha, 2)
    var    float coef0 = (1.0 + coef1 + coef2) * 0.25
    series float ultis = na
    ultis := (  1.0 - coef0) *                             Series   +
       (2.0 * coef0 - coef1) *               nz(Series[1], Series)  -
             (coef0 - coef2) * nz(Series[2], nz(Series[1], Series)) +
                      coef1  *               nz( ultis[1], Series)  -
                      coef2  * nz( ultis[2], nz( ultis[1], Series))
    // ▼▼▼▼▼ Modified Laguerre Lowpass Filter ▼▼▼▼▼
    series float   lerp1 = na, lerp1 := nz(ultis[1], ultis) + Lag * (nz(lerp1[1], ultis) - nz(ultis[1], ultis))
    series float   lerp2 = na, lerp2 := nz(lerp1[1], lerp1) + Lag * (nz(lerp2[1], lerp1) - nz(lerp1[1], lerp1))
    series float   lerp3 = na, lerp3 := nz(lerp2[1], lerp2) + Lag * (nz(lerp3[1], lerp2) - nz(lerp2[1], lerp2))
    series float   lerp4 = na, lerp4 := nz(lerp3[1], lerp3) + Lag * (nz(lerp4[1], lerp3) - nz(lerp1[1], lerp1))
    series float lagFilt = switch LaguerreMode
        4 => 0.0625 * (ultis + lerp1 * 4.0 + lerp2 * 6.0 + lerp3 * 4.0 + lerp4) // Ehlers' original
        3 => 0.125  * (ultis + lerp1 * 3.0 + lerp2 * 3.0 + lerp3)
        2 => 0.25   * (ultis + lerp1 * 2.0 + lerp2)
        1 => 0.5    * (ultis + lerp1)
        =>             ultis // 0
    // ▼▼▼▼▼ Laguerre Oscillator ▼▼▼▼▼
    series float filt = na, filt := -Lag * ultis + nz(ultis[1]) + Lag * nz(filt[1])
    series float  RMS = math.sqrt(ta.sma(math.pow(ultis - filt, 2), RMSperiod))
    series float lOsc = if math.sign(RMS) == 0.0
        0.0
    else
        (ultis - filt) / RMS
    [ultis, lagFilt, lOsc]

series float source = input.source(close, 'Source Series')

var const string grp0 = 'Laguerre options'
var float     period = input.float (20.0, 'Laguerre Period', group=grp0,  minval= 1.0, step=2.0)
var float        lag = input.float ( 0.5, 'Laguerre Lag',    group=grp0,  minval=-0.5, step=0.05, maxval=0.95)
var int laguerreMode = input.int   (   3, 'Laguerre Mode',   group=grp0, options=[0,1,2,3,4], tooltip='This option determines the lag mode')

var const string grp1 = 'Oscillator Only Option'
var int periodRMS = input.int(100, 'RMS Period', group=grp1, minval=5, step=5)


[ultimate, laguerre, laguerreOsc] = laguerreMulti(source, period, lag, laguerreMode, periodRMS)

[ _ , laguerre02, _ ] = laguerreMulti(source, 02, lag, laguerreMode, periodRMS)
[ _ , laguerre03, _ ] = laguerreMulti(source, 03, lag, laguerreMode, periodRMS)
[ _ , laguerre04, _ ] = laguerreMulti(source, 04, lag, laguerreMode, periodRMS)
[ _ , laguerre05, _ ] = laguerreMulti(source, 05, lag, laguerreMode, periodRMS)
[ _ , laguerre06, _ ] = laguerreMulti(source, 06, lag, laguerreMode, periodRMS)
[ _ , laguerre07, _ ] = laguerreMulti(source, 07, lag, laguerreMode, periodRMS)
[ _ , laguerre08, _ ] = laguerreMulti(source, 08, lag, laguerreMode, periodRMS)
[ _ , laguerre09, _ ] = laguerreMulti(source, 09, lag, laguerreMode, periodRMS)

[ _ , laguerre10, _ ] = laguerreMulti(source, 10, lag, laguerreMode, periodRMS)
[ _ , laguerre11, _ ] = laguerreMulti(source, 11, lag, laguerreMode, periodRMS)
[ _ , laguerre12, _ ] = laguerreMulti(source, 12, lag, laguerreMode, periodRMS)
[ _ , laguerre13, _ ] = laguerreMulti(source, 13, lag, laguerreMode, periodRMS)
[ _ , laguerre14, _ ] = laguerreMulti(source, 14, lag, laguerreMode, periodRMS)
[ _ , laguerre15, _ ] = laguerreMulti(source, 15, lag, laguerreMode, periodRMS)
[ _ , laguerre16, _ ] = laguerreMulti(source, 16, lag, laguerreMode, periodRMS)
[ _ , laguerre17, _ ] = laguerreMulti(source, 17, lag, laguerreMode, periodRMS)
[ _ , laguerre18, _ ] = laguerreMulti(source, 18, lag, laguerreMode, periodRMS)
[ _ , laguerre19, _ ] = laguerreMulti(source, 19, lag, laguerreMode, periodRMS)

[ _ , laguerre20, _ ] = laguerreMulti(source, 20, lag, laguerreMode, periodRMS)
[ _ , laguerre21, _ ] = laguerreMulti(source, 21, lag, laguerreMode, periodRMS)
[ _ , laguerre22, _ ] = laguerreMulti(source, 22, lag, laguerreMode, periodRMS)
[ _ , laguerre23, _ ] = laguerreMulti(source, 23, lag, laguerreMode, periodRMS)
[ _ , laguerre24, _ ] = laguerreMulti(source, 24, lag, laguerreMode, periodRMS)
[ _ , laguerre25, _ ] = laguerreMulti(source, 25, lag, laguerreMode, periodRMS)
[ _ , laguerre26, _ ] = laguerreMulti(source, 26, lag, laguerreMode, periodRMS)
[ _ , laguerre27, _ ] = laguerreMulti(source, 27, lag, laguerreMode, periodRMS)
[ _ , laguerre28, _ ] = laguerreMulti(source, 28, lag, laguerreMode, periodRMS)
[ _ , laguerre29, _ ] = laguerreMulti(source, 29, lag, laguerreMode, periodRMS)

[ _ , laguerre30, _ ] = laguerreMulti(source, 30, lag, laguerreMode, periodRMS)
[ _ , laguerre31, _ ] = laguerreMulti(source, 31, lag, laguerreMode, periodRMS)
[ _ , laguerre32, _ ] = laguerreMulti(source, 32, lag, laguerreMode, periodRMS)
[ _ , laguerre33, _ ] = laguerreMulti(source, 33, lag, laguerreMode, periodRMS)
[ _ , laguerre34, _ ] = laguerreMulti(source, 34, lag, laguerreMode, periodRMS)
[ _ , laguerre35, _ ] = laguerreMulti(source, 35, lag, laguerreMode, periodRMS)
[ _ , laguerre36, _ ] = laguerreMulti(source, 36, lag, laguerreMode, periodRMS)
[ _ , laguerre37, _ ] = laguerreMulti(source, 37, lag, laguerreMode, periodRMS)
[ _ , laguerre38, _ ] = laguerreMulti(source, 38, lag, laguerreMode, periodRMS)
[ _ , laguerre39, _ ] = laguerreMulti(source, 39, lag, laguerreMode, periodRMS)

[ _ , laguerre40, _ ] = laguerreMulti(source, 40, lag, laguerreMode, periodRMS)
[ _ , laguerre41, _ ] = laguerreMulti(source, 41, lag, laguerreMode, periodRMS)
[ _ , laguerre42, _ ] = laguerreMulti(source, 42, lag, laguerreMode, periodRMS)
[ _ , laguerre43, _ ] = laguerreMulti(source, 43, lag, laguerreMode, periodRMS)
[ _ , laguerre44, _ ] = laguerreMulti(source, 44, lag, laguerreMode, periodRMS)
[ _ , laguerre45, _ ] = laguerreMulti(source, 45, lag, laguerreMode, periodRMS)
[ _ , laguerre46, _ ] = laguerreMulti(source, 46, lag, laguerreMode, periodRMS)
[ _ , laguerre47, _ ] = laguerreMulti(source, 47, lag, laguerreMode, periodRMS)
[ _ , laguerre48, _ ] = laguerreMulti(source, 48, lag, laguerreMode, periodRMS)
[ _ , laguerre49, _ ] = laguerreMulti(source, 49, lag, laguerreMode, periodRMS)

[ _ , laguerre50, _ ] = laguerreMulti(source, 50, lag, laguerreMode, periodRMS)
[ _ , laguerre51, _ ] = laguerreMulti(source, 51, lag, laguerreMode, periodRMS)
[ _ , laguerre52, _ ] = laguerreMulti(source, 52, lag, laguerreMode, periodRMS)
[ _ , laguerre53, _ ] = laguerreMulti(source, 53, lag, laguerreMode, periodRMS)
[ _ , laguerre54, _ ] = laguerreMulti(source, 54, lag, laguerreMode, periodRMS)
[ _ , laguerre55, _ ] = laguerreMulti(source, 55, lag, laguerreMode, periodRMS)
[ _ , laguerre56, _ ] = laguerreMulti(source, 56, lag, laguerreMode, periodRMS)
[ _ , laguerre57, _ ] = laguerreMulti(source, 57, lag, laguerreMode, periodRMS)
[ _ , laguerre58, _ ] = laguerreMulti(source, 58, lag, laguerreMode, periodRMS)
[ _ , laguerre59, _ ] = laguerreMulti(source, 59, lag, laguerreMode, periodRMS)


plot(laguerreOsc, '', #8080FF)
hline( 1.0, '', #FF000080, linestyle=hline.style_dotted)
hline( 0.0, '', #EEEEEE)
hline(-1.0, '', #00FF0080, linestyle=hline.style_dotted)

var HIDE_STATUS_SCALE_VALUES = display.all - display.status_line - display.price_scale
plot(laguerre02, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre03, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre04, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre05, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre06, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre07, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre08, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre09, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)

plot(laguerre10, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre11, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre12, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre13, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre14, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre15, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre16, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre17, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre18, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre19, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)

plot(laguerre20, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre21, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre22, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre23, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre24, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre25, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre26, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre27, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre28, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre29, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)

plot(laguerre30, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre31, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre32, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre33, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre34, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre35, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre36, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre37, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre38, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre39, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)

plot(laguerre40, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre41, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre42, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre43, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre44, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre45, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre46, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre47, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre48, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre49, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)

plot(laguerre50, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre51, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre52, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre53, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre54, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre55, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre56, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre57, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre58, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre59, '', #8080FF, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)

plot(ultimate, '', #FFCC00,    force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
plot(laguerre, '', #990099, 2, force_overlay=true, display=HIDE_STATUS_SCALE_VALUES)
