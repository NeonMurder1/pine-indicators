// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© RafaelZioni
//@version=4
study(title='SAR channel', overlay=true)

len = input(100)

z(close, len) =>
    h = 0.0
    d = 0.0
    for i = 0 to len - 1
        k = (len - i) * len
        h := h + k
        d := d + close[i] * k
    d / h

c = z(close, floor(sqrt(len)))
//

//
start = 0.01
increment = 0.01
maximum = 0.2
s = sar(start, increment, maximum)
s1=z(s,len)
pc = close < s1 ? color.red : color.green
plot(s1, style=plot.style_cross, color=pc,linewidth=1)

m=input(2)
sdev = stdev(close, len)
dev = m * sdev
top=s1+dev
bott=s1-dev
calculationToPlotAverageMeanLine=s1
useUpperDeviation = input(true, "Upper Deviation", input.bool)
useLowerDeviation = input(true, "Lower Deviation", input.bool)



calculationToPlotUpperLine=top
calculationToPlotLowerLine=bott

plotUpperDeviationLine = plot(not useUpperDeviation ? na : calculationToPlotUpperLine, color=pc)
plotAverageMeanLine = plot(calculationToPlotAverageMeanLine, color=pc)
plotLowererDeviationLine = plot(not useLowerDeviation ? na : calculationToPlotLowerLine, color=pc)
fill(plotUpperDeviationLine, plotAverageMeanLine, color=color.blue)
fill(plotLowererDeviationLine, plotAverageMeanLine, color=color.red)